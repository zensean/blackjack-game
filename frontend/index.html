<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack 21é»ï¼šå…¨æœå…±é¬¥ç‰ˆ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â™ ï¸</text></svg>">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #2c3e50; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        .container { width: 90%; max-width: 600px; background: #34495e; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); margin-top: 20px; }
        
        h2 { text-align: center; color: #f1c40f; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #95a5a6; font-size: 0.9em; margin-bottom: 20px; }

        /* é€£ç·šå€å¡Š */
        .conn-box { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        input[type="text"] { padding: 8px; border-radius: 5px; border: none; width: 150px; }
        button { cursor: pointer; border: none; border-radius: 5px; padding: 8px 15px; font-weight: bold; transition: 0.2s; }
        .btn-connect { background: #27ae60; color: white; }
        .btn-disconnect { background: #c0392b; color: white; display: none; }
        
        /* éŠæˆ²æ§åˆ¶å€ (é è¨­éš±è—) */
        #game-controls { display: none; text-align: center; margin-bottom: 15px; padding: 15px; background: #2c3e50; border-radius: 8px; }
        
        .btn-start { background: #f39c12; color: white; font-size: 1.2em; padding: 10px 30px; width: 100%; }
        .action-group { display: none; gap: 10px; justify-content: center; }
        .btn-hit { background: #e74c3c; color: white; padding: 15px 30px; font-size: 1.2em; }
        .btn-stand { background: #3498db; color: white; padding: 15px 30px; font-size: 1.2em; }
        
        button:disabled { background: #7f8c8d; cursor: not-allowed; }
        button:hover:not(:disabled) { opacity: 0.9; transform: scale(1.05); }

        /* è¨Šæ¯é¡¯ç¤ºå€ */
        #log { height: 300px; overflow-y: auto; background: #ecf0f1; color: #2c3e50; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 14px; }
        .msg-line { margin-bottom: 4px; padding: 2px 5px; border-bottom: 1px solid #ddd; }
        .msg-system { color: #8e44ad; font-weight: bold; }
        .msg-success { color: #27ae60; background: #d5f5e3; }
        .msg-fail { color: #c0392b; background: #fadbd8; }
        .msg-info { color: #2980b9; }

        /* ç‹€æ…‹ç‡ˆ */
        .status-dot { height: 10px; width: 10px; background-color: #bbb; border-radius: 50%; display: inline-block; margin-right: 5px; }
        .connected .status-dot { background-color: #2ecc71; box-shadow: 0 0 5px #2ecc71; }
    </style>
</head>
<body>

    <div class="container">
        <h2>â™ ï¸ SWAG 21é»</h2>
        <div class="subtitle">ğŸ”¥ å…¨æœå…±é¬¥ç‰ˆ (Twitch Plays Blackjack)</div>

        <div class="conn-box" id="conn-box">
            <span class="status-dot"></span>
            <input type="text" id="clientId" value="Player1" placeholder="è¼¸å…¥æš±ç¨±">
            <button onclick="connect()" class="btn-connect" id="btnConnect">é€£ç·š (Connect)</button>
            <button onclick="disconnect()" class="btn-disconnect" id="btnDisconnect">æ–·ç·š</button>
        </div>

        <div id="game-controls">
            <button onclick="sendAction('start')" class="btn-start" id="btnStart">ğŸ‘‘ é–‹å•Ÿæ–°å±€</button>
            
            <div class="action-group" id="actionBtns">
                <button onclick="sendAction('hit')" class="btn-hit">âš¡ è¦ç‰Œ (Hit)</button>
                <button onclick="sendAction('stand')" class="btn-stand">ğŸ›‘ åœç‰Œ (Stand)</button>
            </div>
        </div>

        <div id="log">
            <div class="msg-line" style="color: #7f8c8d;">ç­‰å¾…é€£ç·šä¸­...</div>
        </div>
    </div>

    <script>
        var ws = null;
        var btnConnect = document.getElementById("btnConnect");
        var btnDisconnect = document.getElementById("btnDisconnect");
        var gameControls = document.getElementById("game-controls");
        var btnStart = document.getElementById("btnStart");
        var actionBtns = document.getElementById("actionBtns");
        var log = document.getElementById("log");
        var connBox = document.getElementById("conn-box");

        function connect() {
            
            var clientId = document.getElementById("clientId").value || "Guest";
            // é€™è£¡æ”¹æˆä½ çš„ API è·¯å¾‘
            // --- [ä¿®æ”¹é–‹å§‹] è‡ªå‹•åˆ¤æ–·é€£ç·šç¶²å€ ---
            var protocol = window.location.protocol === "https:" ? "wss://" : "ws://";
            var host = window.location.host; // é€™æœƒè‡ªå‹•æŠ“å– "ä½ çš„IP" æˆ–æ˜¯ "ä½ çš„ç¶²åŸŸ"
            
            // å¦‚æœæ˜¯åœ¨ AWS é€é Nginx (Port 80) è½‰ç™¼ï¼Œé€™è£¡ä¸éœ€è¦åŠ  :8000
            // å¦‚æœæ˜¯åœ¨ æœ¬æ©Ÿé–‹ç™¼ (Port 8000)ï¼Œwindow.location.host å·²ç¶“åŒ…å« :8000 äº†
            
            var wsUrl = protocol + host + "/ws/" + clientId;
            console.log("å˜—è©¦é€£ç·šåˆ°:", wsUrl); // æ–¹ä¾¿é™¤éŒ¯ç”¨
            
            ws = new WebSocket(wsUrl);
            // --- [ä¿®æ”¹çµæŸ] ---

            ws.onopen = function() {
                addLog("âœ… å·²é€£ç·šåˆ°ä¼ºæœå™¨", "msg-system");
                toggleUI(true);
                connBox.classList.add("connected");
            };

            ws.onmessage = function(event) {
                var msg = event.data;
                
                // ç°¡å–®çš„é—œéµå­—åˆ¤æ–·ä¾†æ”¹è®Šé¡è‰² (Frontend Logic)
                var cssClass = "msg-info";
                if (msg.includes("ç²å‹") || msg.includes("æˆåŠŸ")) cssClass = "msg-success";
                if (msg.includes("çˆ†ç‰Œ") || msg.includes("è¼¸")) cssClass = "msg-fail";
                if (msg.includes("ç³»çµ±")) cssClass = "msg-system";

                addLog(msg, cssClass);

                // è‡ªå‹•åˆ‡æ›æŒ‰éˆ•ç‹€æ…‹ (ç°¡å–®çš„ç‹€æ…‹æ©Ÿ)
                if (msg.includes("éŠæˆ²é–‹å§‹") || msg.includes("åŠ ç‰Œ") || msg.includes("è¦ç‰ŒæˆåŠŸ")) {
                    btnStart.style.display = "none";
                    actionBtns.style.display = "flex";
                } else if (msg.includes("æœ€çµ‚çµæœ") || msg.includes("çˆ†ç‰Œ") || msg.includes("èŠå®¶ç²å‹")) {
                    btnStart.style.display = "block";
                    btnStart.innerText = "ğŸ”„å†ä¾†ä¸€å±€";
                    actionBtns.style.display = "none";
                }
            };

            ws.onclose = function() {
                addLog("âŒ é€£ç·šå·²ä¸­æ–·", "msg-fail");
                toggleUI(false);
                connBox.classList.remove("connected");
            };
        }

        function disconnect() {
            if (ws) ws.close();
        }

        function sendAction(action) {
            if (ws) {
                ws.send(action);
            }
        }

        function addLog(text, className) {
            // æŠŠæ›è¡Œç¬¦è™Ÿè½‰æˆ HTML æ›è¡Œ
            var formattedText = text.replace(/\n/g, "<br>");
            log.innerHTML += `<div class="msg-line ${className}">${formattedText}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function toggleUI(isConnected) {
            btnConnect.style.display = isConnected ? "none" : "block";
            btnDisconnect.style.display = isConnected ? "block" : "none";
            document.getElementById("clientId").disabled = isConnected;
            gameControls.style.display = isConnected ? "block" : "none";
            
            // é è¨­ç‹€æ…‹
            if(isConnected) {
                btnStart.style.display = "block";
                actionBtns.style.display = "none";
            }
        }
    </script>
</body>
</html>